image: tanmer/tmf
services:
  - tanmer/postgresql
variables:
  POSTGRES_DB: tmf_test
  POSTGRES_USER: runner
  POSTGRES_PASSWORD: ""

before_script:
  - source /etc/profile.d/rvm.sh
  - gem i bundler --no-ri --no-rdoc
  - bundle install
  - cp config/database.yml.test config/database.yml
test:
  script:
    - export RAILS_ENV=test
    - bundle exec rake db:drop
    - bundle exec rake db:create
    - bundle exec rake db:migrate
    - bundle exec rake spec
    - unset RAILS_ENV
